<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>JarvisCore – Authenticator</title>
    <link rel="stylesheet" href="styles.css">
</head>
<body>
    <div class="ui-backdrop" aria-hidden="true">
        <div class="ui-backdrop__gradient ui-backdrop__gradient--one"></div>
        <div class="ui-backdrop__gradient ui-backdrop__gradient--two"></div>
        <div class="ui-backdrop__grid"></div>
    </div>

    <main id="app">
        <header class="app-header">
            <div>
                <h1>JarvisCore</h1>
                <p class="subtitle">Zwei-Faktor-Authentifizierung</p>
            </div>
        </header>

        <section class="info-block">
            <header>
                <h3>Authenticator verknüpfen</h3>
                <button type="button" id="authenticator-open">Setup öffnen</button>
            </header>
            <p>Schütze die Weboberfläche mit einem zweiten Faktor. JarvisCore erzeugt einen einmaligen QR-Code,
                den du mit einer TOTP-fähigen App (z.&nbsp;B. Google Authenticator, Authy oder Microsoft Authenticator)
                scannen kannst. Danach gibst du den sechsstelligen Code ein, um die Einrichtung abzuschließen.</p>
        </section>

        <section class="info-block">
            <header>
                <h3>So funktioniert es</h3>
            </header>
            <ol>
                <li>Starte JarvisCore im Terminal und öffne anschließend diese Seite.</li>
                <li>Klicke auf „Setup öffnen“ oder warte, bis das Fenster automatisch erscheint.</li>
                <li>Scanne den QR-Code mit deiner Authenticator-App oder tippe den angezeigten Schlüssel ab.</li>
                <li>Gib den aktuellen sechsstelligen Code ein, damit JarvisCore die App akzeptiert.</li>
            </ol>
        </section>

        <div id="authenticator-status" class="notification is-info">
            Warte auf Rückmeldung von JarvisCore …
        </div>
    </main>

    <div id="authenticator-modal" class="modal">
        <div class="modal-background"></div>
        <div class="modal-card">
            <header class="modal-card-head">
                <p class="modal-card-title">Authenticator einrichten</p>
                <button class="delete" id="authenticator-close" aria-label="close"></button>
            </header>
            <section class="modal-card-body">
                <p id="authenticator-token-warning" class="notification is-warning is-hidden">
                    Bitte gib zunächst oben den Web-Token ein, bevor du den Authenticator einrichtest.
                </p>
                <p id="authenticator-info" class="qr-info">Scanne diesen QR-Code mit deiner Authenticator-App (z. B. Google Authenticator).</p>
                <div class="qr-container">
                    <div id="authenticator-qr"></div>
                </div>
                <div class="secret-container">
                    <span>Oder nutze diesen Schlüssel:</span>
                    <strong id="authenticator-secret">---</strong>
                    <button type="button" class="icon-btn" id="authenticator-copy" title="Schlüssel kopieren">
                        <svg width="18" height="18" viewBox="0 0 16 16" fill="currentColor" aria-hidden="true">
                            <path d="M10.97 4.97a.75.75 0 0 1 1.07 1.05l-3.99 4.99a.75.75 0 0 1-1.08.02L4.324 8.384a.75.75 0 1 1 1.06-1.06l2.094 2.093 3.473-4.425a.267.267 0 0 1 .02-.022z"/>
                        </svg>
                    </button>
                </div>
                <p class="has-text-centered">
                    Provisioning-URL:
                    <a id="authenticator-uri" href="#" target="_blank" rel="noreferrer">App öffnen</a>
                </p>
                <div class="field">
                    <label class="label">Aktueller Code</label>
                    <div class="control">
                        <input id="authenticator-code" class="input" type="text" placeholder="123456" maxlength="6" pattern="[0-9]*" inputmode="numeric" autocomplete="one-time-code" spellcheck="false">
                    </div>
                    <p class="help">Gib den aktuellen 6-stelligen Code aus deiner Authenticator-App ein.</p>
                </div>
                <div id="authenticator-loading" class="notification is-info is-hidden">
                    Bestätigung läuft ...
                </div>
                <div id="authenticator-error" class="notification is-danger is-hidden"></div>
                <div id="authenticator-success" class="notification is-success is-hidden">
                    Erfolgreich! Die Zwei-Faktor-Authentifizierung wurde aktiviert.
                </div>
            </section>
            <footer class="modal-card-foot">
                <button id="authenticator-confirm" class="button is-primary">Bestätigen</button>
                <button class="button" id="authenticator-cancel">Später</button>
            </footer>
        </div>
    </div>

    <script src="js/vendor/qrcode.min.js"></script>
    <script src="js/security.js"></script>
</body>
</html>
